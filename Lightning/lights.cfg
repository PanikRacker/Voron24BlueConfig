[gcode_macro LIGHTSWITCH_ON]
gcode:
    UPDATE_DELAYED_GCODE ID=DELAYED_LIGHTSWITCH_ON DURATION=0
    SWITCH_ON_HEADLIGHT

[delayed_gcode DELAYED_LIGHTSWITCH_ON]
gcode:
    LIGHTSWITCH_ON DURATION=1
    UPDATE_DELAYED_GCODE ID=DELAYED_LIGHTSWITCH_ON DURATION={duration}

[gcode_macro LIGHTSWITCH_OFF]
gcode:
    {% set duration = params.DURATION | default(1) | int %}
    {% if duration == 1 %}
        _TURN_OFF_LIGHT_CHECK
    {% endif %}
    UPDATE_DELAYED_GCODE ID=SWITCH_OFF_HEADLIGHT DURATION={duration}

[delayed_gcode DELAYED_LIGHTSWITCH_OFF]
gcode:
    LIGHTSWITCH_OFF DURATION=2
    UPDATE_DELAYED_GCODE ID=DELAYED_LIGHTSWITCH_OFF DURATION=300

[gcode_macro _TURN_OFF_LIGHT_CHECK]
gcode:
    UPDATE_DELAYED_GCODE ID=DELAYED_LIGHTSWITCH_OFF DURATION=0
