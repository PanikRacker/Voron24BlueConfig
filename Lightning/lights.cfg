[gcode_macro SWITCH_OFF_LIGHTS]
gcode:
    {% set duration = params.DURATION | default(1) | int %}
    {% if duration == 1 %}
        _TURN_OFF_LIGHT_CHECK
    {% endif %}
    UPDATE_DELAYED_GCODE ID=SWITCH_OFF_HEADLIGHT DURATION={duration}

[delayed_gcode DELAYED_LIGHTSWITCH]
gcode:
    SWITCH_OFF_LIGHTS DURATION=2
    UPDATE_DELAYED_GCODE ID=DELAYED_LIGHTSWITCH DURATION=300

[gcode_macro _TURN_OFF_LIGHT_CHECK]
gcode:
    UPDATE_DELAYED_GCODE ID=DELAYED_LIGHTSWITCH DURATION=0
