[gcode_macro _SET_ACTIVE_SPOOL]
gcode:
    {% if params.ID %}
        {% set id = params.ID|int %}
        {action_call_remote_method("spoolman_set_active_spool", spool_id=id)}
    {% else %}
        {action_respond_info("Parameter 'ID' is required")}
    {% endif %}

[gcode_macro CLEAR_ACTIVE_SPOOL]
gcode:
    {action_call_remote_method("spoolman_set_active_spool", spool_id=None)}

[gcode_shell_command BACKUP_SPOOLMAN]
command: /usr/bin/bash /home/voron24blue/printer_data/config/spoolman.sh
timeout: 30
verbose: True

[delayed_gcode BACKUP_SPOOLMAN]
gcode:
    RUN_SHELL_COMMAND CMD=shutdown

[gcode_macro BACKUP_SPOOLMAN]
gcode:
    {% set duration = params.DURATION | default(1) | int %}
    UPDATE_DELAYED_GCODE ID=BACKUP_SPOOLMAN DURATION={duration}

[gcode_macro BACKUP_SPOOLMAN_RANDOMIZED]
gcode:
    {% if ((range(10) | random) % 2) > 0 %}
        BACKUP_SPOOLMAN
    {% endif %}