[gcode_macro HEAT_SOAK_DEFAULT]
gcode:
    {% set BED_TEMP = params.BED_TEMP | default(115) | float | round %}
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP | default(150) | float | round %}
    {% set CHAMBER_SOAK_TEMP = params.SOAK_TEMP | default(55) | float | round %}
    {% set TIMEOUT = params.TIMEOUT | default(120) | int %}
    {% set CURRENT_CHAMBER_TEMP = printer['temperature_sensor chamber'].temperature | float | round(0, 'floor') %}

    _status_heating
    M140 S{BED_TEMP}
    M104 S{EXTRUDER_TEMP}

    SET_FAN_SPEED FAN=Nevermore SPEED=0.5
    CANCEL_POWER_OFF

    {% if CURRENT_CHAMBER_TEMP < CHAMBER_SOAK_TEMP %}
        _PARKWARMUP
        HEAT_SOAK SOAKER='temperature_sensor chamber' SOAK_TEMP={CHAMBER_SOAK_TEMP} RATE=0.1 RATE_SMOOTH=30 TIMEOUT={TIMEOUT}
    {% else %}
        _status_ready
        _PARKPAUSE
    {% endif %}
