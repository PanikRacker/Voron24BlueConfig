[gcode_macro _PARK_SAFE]
gcode:
    {% set location = params.LOCATION | lower %}
    {% set max_z = printer.toolhead.axis_maximum.z | float %}
    {% set current_y = printer.toolhead.position.y | float %}
    {% set current_z = printer.toolhead.position.z | float %}
    CG28
    G90
    {% if current_z < max_z %}
        G0 Z{current_z+5}
    {% endif %}
    {% if current_y > printer.toolhead.axis_maximum.y-5 %}
        _DEBUG MSG="Move toolhead backwards savely"
        G0 Y{printer.toolhead.axis_maximum.y-5}
    {% endif %}
    PARK LOCATION={location}