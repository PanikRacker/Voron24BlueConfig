[gcode_macro _CALIBRATE_Z]
gcode:
    {% set extruder_temp = params.EXTRUDER_TEMP | default(0) | float %}
    {% set ending_temp = params.ENDING_TEMP | default(extruder_temp) | float %}

    {% if extruder_temp > 0 %}
        PREPARE_NOZZLE EXTRUDER_TEMP={extruder_temp} DO_PURGE={False} ENDING_TEMP={ending_temp} 
    {% endif %}
    _status_calibrating_z
    G28 Z
    _status_off