[gcode_macro PREPARE_NOZZLE]
gcode:
    {% set EXTRUDER_TEMP = params.EXTRUDER | default(0) | float %}
    {% set CLEAN_HOT = EXTRUDER_TEMP > 0 %}

    M104 S{EXTRUDER_TEMP}
    CG28

    {% if CLEAN_HOT %}
        PARKPURGE
        _status_heating
        M109 S{EXTRUDER_TEMP}
    {% endif %}

    _status_cleaning
    clean_nozzle

    {% if CLEAN_HOT %}
        M109 S{EXTRUDER_TEMP * 0.9}
        M104 S{EXTRUDER_TEMP * 0.75}
        clean_nozzle
        clean_nozzle
    {% endif %}

    _status_off