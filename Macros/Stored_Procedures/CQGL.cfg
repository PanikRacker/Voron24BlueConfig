[gcode_macro CQGL]
gcode:
    {% set CALIBRATE_Z = params.CALIBRATE_Z | default(True) | float %}
    {% if printer.quad_gantry_level.applied == False %}
        CG28
        _status_leveling
        QUAD_GANTRY_LEVEL
        {% if CALIBRATE_Z %}
          _status_calibrating_z
          G28 Z
        {% endif %}
        _status_off
    {% endif %}