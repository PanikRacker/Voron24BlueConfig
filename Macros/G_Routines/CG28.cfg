[gcode_macro CG28]
gcode:
    {% set homing_axes = [] %}

    {% if "x" not in printer.toolhead.homed_axes %}
        {% homing_axes.append("x") %}
    {% endif %}
    {% if "y" not in printer.toolhead.homed_axes %}
        {% homing_axes.append("y") %}
    {% endif %}
    {% if "y" not in printer.toolhead.homed_axes %}
        {% homing_axes.append("z") %}
    {% endif %}

    {% if "x" not in printer.toolhead.homed_axes or "y" not in printer.toolhead.homed_axes or "z" not in printer.toolhead.homed_axes %}
        _status_homing
        G28 {"".join(homing_axes)}
        _status_off
    {% endif %}