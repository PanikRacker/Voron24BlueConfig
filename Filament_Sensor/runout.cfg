[gcode_macro _RUNOUT]
gcode:
    PAUSE
    _DEBUG MSG="Filament switch runout"
    LIGHTSWITCH_ON
    UPDATE_DELAYED_GCODE ID=CANCEL_PRINT_AT_RUNOUT DURATION=600

[delayed_gcode CANCEL_PRINT_AT_RUNOUT]
gcode:
    {% if printer['pause_resume'].is_paused %}
        CANCEL_PRINT
        ENABLE_POWER_OFF
        PRINT_END
    {% endif %}